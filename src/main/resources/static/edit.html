<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Edit Data</title>
</head>
<body>
<h1>Edit Data</h1>
<form id="editForm">
    <label for="documentId">Document ID:</label><br>
    <input type="text" id="documentId" name="documentId" readonly><br> <!-- Display document ID here -->

    <label for="from">From:</label><br>
    <input type="text" id="from" name="from"><br>

    <label for="to">To:</label><br>
    <input type="text" id="to" name="to"><br>

    <label for="name">Name:</label><br>
    <input type="text" id="name" name="name"><br>

    <label for="challanNo">Challan No:</label><br>
    <input type="text" id="challanNo" name="challanNo"><br>

    <label for="itemName">Item Name:</label><br>
    <input type="text" id="itemName" name="itemName"><br>

    <label for="quantity">Quantity:</label><br>
    <input type="text" id="quantity" name="quantity"><br>

    <label for="price">Price:</label><br>
    <input type="text" id="price" name="price"><br>

    <button type="button" onclick="submitEdit()">Submit</button>
</form>
<script>
// Function to populate the form fields with data fetched from the server
function populateFormFields(documentData) {
    document.getElementById("from").value = documentData.from;
    document.getElementById("to").value = documentData.to;
    document.getElementById("name").value = documentData.name;
    document.getElementById("challanNo").value = documentData.challanNo;
    document.getElementById("itemName").value = documentData.itemName;
    document.getElementById("quantity").value = documentData.quantity;
    document.getElementById("price").value = documentData.price;
}

// Function to fetch document data and populate the form fields
function populateFormData(documentId) {
    var xhr = new XMLHttpRequest();
    xhr.open("GET", "/get/" + documentId, true);
    xhr.setRequestHeader("Content-Type", "application/json");
    xhr.onreadystatechange = function () {
        if (xhr.readyState === XMLHttpRequest.DONE) {
            if (xhr.status === 200) {
                var documentData = JSON.parse(xhr.responseText);
                populateFormFields(documentData);
            } else {
                alert("Failed to fetch document data");
            }
        }
    };
    xhr.send();
}

// Function to submit the edit form
function submitEdit() {
    var form = document.getElementById("editForm");
    var formData = new FormData(form);
    var data = {};
    formData.forEach(function(value, key){
        data[key] = value;
    });
    var documentId = document.getElementById("documentId").value;
    var xhr = new XMLHttpRequest();
    xhr.open("PUT", "/update/" + documentId, true);
    xhr.setRequestHeader("Content-Type", "application/json");
    xhr.onreadystatechange = function () {
        if (xhr.readyState === XMLHttpRequest.DONE) {
            if (xhr.status === 200) {
                window.location.href = "/dashboard";
            } else {
                alert("Failed to edit data");
            }
        }
    };
    xhr.send(JSON.stringify(data));
}

// Call the function to populate the form fields with data when the page loads
window.onload = function () {
    var urlParams = new URLSearchParams(window.location.search);
    var documentId = urlParams.get('documentId');
    document.getElementById("documentId").value = documentId;
    populateFormData(documentId);
};
</script>
</body>
</html>
